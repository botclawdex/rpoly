<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenClaw Brain | Autonomous Trading Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#0a0a0a; --card:#0d1117; --card-hover:#161b22;
      --border:#1a2a1a; --border-bright:#2a4a2a;
      --text:#c9d1d9; --text-dim:#5a6a5a; --text-bright:#e0ffe0;
      --green:#00ff41; --green-dim:#00cc33; --green-glow:rgba(0,255,65,0.12);
      --red:#ff3333; --red-glow:rgba(255,51,51,0.12);
      --yellow:#ffaa00; --blue:#4da6ff;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior:smooth; }
    body { font-family:'JetBrains Mono',monospace; background:var(--bg); color:var(--text); font-size:13px; line-height:1.6; overflow-x:hidden; overflow-y:scroll; }
    body::before {
      content:'';position:fixed;top:0;left:0;width:100%;height:100%;
      background:repeating-linear-gradient(0deg,rgba(0,0,0,0.1),rgba(0,0,0,0.1) 1px,transparent 1px,transparent 2px);
      pointer-events:none;z-index:1000;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width:6px; }
    ::-webkit-scrollbar-track { background:var(--bg); }
    ::-webkit-scrollbar-thumb { background:var(--border-bright); border-radius:3px; }

    /* Header */
    header {
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center;
      padding:10px 24px; border-bottom:1px solid var(--border); margin-bottom:0;
    }
    header > div:last-child { justify-self:end; }
    .logo { font-size:22px; font-weight:700; color:var(--green); text-decoration:none; }
    .logo span { color:var(--text); }
    .nav-tab {
      display:inline-block; padding:5px 12px; font-size:10px; font-weight:600;
      letter-spacing:1px; text-transform:uppercase; text-decoration:none;
      color:var(--text-dim); border:1px solid transparent; transition:all .2s;
    }
    .nav-tab:hover { color:var(--green); background:rgba(0,255,65,0.05); border-color:rgba(0,255,65,0.15); }
    .nav-tab-active { color:var(--green); border-color:rgba(0,255,65,0.25); background:rgba(0,255,65,0.06); }
    .header-clock {
      display:flex; align-items:center; gap:6px;
      padding:4px 14px; background:rgba(0,255,65,0.04);
      border:1px solid rgba(0,255,65,0.15); border-radius:3px;
    }
    .clock-time { font-size:14px; font-weight:700; color:var(--green); letter-spacing:1.5px; text-shadow:0 0 8px rgba(0,255,65,0.5), 0 0 20px rgba(0,255,65,0.2); }
    .clock-label { font-size:9px; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px; opacity:0.7; }
    .clock-sep { font-size:12px; color:rgba(0,255,65,0.3); margin:0 2px; }
    .dot { width:6px; height:6px; border-radius:50%; display:inline-block; }
    .dot.on { background:var(--green); box-shadow:0 0 8px var(--green); animation:pulse 2s infinite; }
    .dot.off { background:var(--red); }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

    /* Sections */
    section { padding:100px 32px 60px; max-width:1100px; margin:0 auto; }
    section:first-of-type { padding-top:60px; }

    /* Hero */
    .hero { text-align:center; padding-top:60px; padding-bottom:40px; }
    .hero-pre { font-size:11px; letter-spacing:3px; text-transform:uppercase; color:var(--green); margin-bottom:16px; opacity:0.7; }
    .hero h1 { font-size:42px; font-weight:900; color:var(--text-bright); line-height:1.1; margin-bottom:20px; }
    .hero h1 .accent { color:var(--green); text-shadow:0 0 30px rgba(0,255,65,0.3); }
    .hero-sub { font-size:14px; color:var(--text-dim); max-width:600px; margin:0 auto 32px; line-height:1.7; }
    .hero-badges { display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-bottom:40px; }
    .badge { padding:4px 12px; border:1px solid var(--border); font-size:10px; letter-spacing:1px; text-transform:uppercase; color:var(--text-dim); }
    .badge.live { border-color:var(--green); color:var(--green); background:rgba(0,255,65,0.05); }
    .hero-cta { display:flex; gap:12px; justify-content:center; }
    .btn { padding:10px 24px; font-family:inherit; font-size:12px; font-weight:700; letter-spacing:1px; text-transform:uppercase; text-decoration:none; cursor:pointer; transition:all .2s; }
    .btn-primary { background:var(--green); color:var(--bg); border:1px solid var(--green); }
    .btn-primary:hover { box-shadow:0 0 20px rgba(0,255,65,0.3); }
    .btn-ghost { background:transparent; color:var(--green); border:1px solid var(--border-bright); }
    .btn-ghost:hover { border-color:var(--green); background:rgba(0,255,65,0.05); }

    /* Section headers */
    .section-label { font-size:10px; letter-spacing:3px; text-transform:uppercase; color:var(--green); margin-bottom:8px; opacity:0.6; }
    .section-title { font-size:24px; font-weight:700; color:var(--text-bright); margin-bottom:8px; }
    .section-sub { font-size:12px; color:var(--text-dim); margin-bottom:32px; max-width:600px; }

    /* Cards grid */
    .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; }
    .grid-2 { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; }

    .card { background:var(--card); border:1px solid var(--border); padding:20px; transition:border-color .2s, transform .2s; }
    .card:hover { border-color:var(--border-bright); transform:translateY(-2px); }
    .card-icon { font-size:20px; margin-bottom:12px; }
    .card-title { font-size:13px; font-weight:700; color:var(--text-bright); margin-bottom:6px; }
    .card-text { font-size:11px; color:var(--text-dim); line-height:1.6; }
    .card-tag { display:inline-block; padding:2px 8px; font-size:9px; letter-spacing:1px; text-transform:uppercase; margin-top:10px; }
    .tag-live { background:rgba(0,255,65,0.1); color:var(--green); border:1px solid rgba(0,255,65,0.2); }
    .tag-soon { background:rgba(255,170,0,0.1); color:var(--yellow); border:1px solid rgba(255,170,0,0.2); }
    .tag-exp { background:rgba(77,166,255,0.1); color:var(--blue); border:1px solid rgba(77,166,255,0.2); }

    /* Live data cards */
    .live-card { position:relative; overflow:hidden; }
    .live-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg, transparent, var(--green), transparent); opacity:0.4; }
    .live-val { font-size:22px; font-weight:900; color:var(--green); margin:8px 0 4px; }
    .live-label { font-size:9px; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px; }
    .live-chart { width:100%; height:60px; margin-top:8px; }
    .live-row { display:flex; justify-content:space-between; align-items:center; padding:3px 0; font-size:10px; border-bottom:1px solid rgba(255,255,255,0.03); }
    .live-row:last-child { border:none; }

    /* Ratio bar */
    .ratio-bar { height:6px; background:var(--border); margin:8px 0; display:flex; overflow:hidden; }
    .ratio-buy { background:var(--green); transition:width .5s; }
    .ratio-sell { background:var(--red); transition:width .5s; }

    /* API docs */
    .api-endpoint { background:var(--card); border:1px solid var(--border); margin-bottom:8px; overflow:hidden; }
    .api-header { display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer; transition:background .2s; }
    .api-header:hover { background:var(--card-hover); }
    .api-method { padding:2px 8px; font-size:10px; font-weight:700; letter-spacing:1px; background:rgba(0,255,65,0.1); color:var(--green); }
    .api-path { font-size:12px; color:var(--text-bright); font-weight:500; }
    .api-desc { font-size:10px; color:var(--text-dim); margin-left:auto; }
    .api-chevron { color:var(--text-dim); font-size:10px; transition:transform .2s; margin-left:8px; }
    .api-body { display:none; padding:0 16px 16px; }
    .api-body.open { display:block; }
    .api-chevron.open { transform:rotate(90deg); }
    .code-block { background:#080c08; border:1px solid var(--border); padding:12px; font-size:10px; line-height:1.6; overflow-x:auto; margin-top:8px; color:var(--text-dim); white-space:pre; }
    .code-block .kw { color:var(--green); }
    .code-block .str { color:var(--yellow); }
    .code-block .num { color:var(--blue); }

    /* Signal list */
    .signal-list { display:flex; flex-direction:column; gap:0; }
    .signal-row {
      display:grid; grid-template-columns:3px 140px 1fr auto;
      align-items:center; gap:0 16px;
      padding:14px 0; border-bottom:1px solid rgba(255,255,255,0.04);
      transition:background .2s;
    }
    .signal-row:last-child { border-bottom:none; }
    .signal-row:hover { background:rgba(0,255,65,0.02); }
    .signal-accent { width:3px; height:100%; min-height:20px; border-radius:2px; }
    .signal-name { font-size:13px; font-weight:700; color:var(--text-bright); white-space:nowrap; }
    .signal-desc { font-size:11px; color:var(--text-dim); line-height:1.5; }
    .signal-status { font-size:9px; font-weight:700; letter-spacing:1px; text-transform:uppercase; color:var(--green); padding:3px 10px; border:1px solid rgba(0,255,65,0.25); background:rgba(0,255,65,0.06); white-space:nowrap; }
    @media (max-width:700px) {
      .signal-row { grid-template-columns:3px 1fr auto; }
      .signal-desc { display:none; }
    }

    /* Agent section */
    .agent-section { background:linear-gradient(135deg, rgba(0,255,65,0.03) 0%, rgba(77,166,255,0.03) 100%); border:1px solid var(--border); padding:40px; text-align:center; }
    .agent-section h3 { font-size:20px; font-weight:700; color:var(--text-bright); margin-bottom:8px; }
    .agent-section p { font-size:12px; color:var(--text-dim); max-width:500px; margin:0 auto 24px; }
    .agent-features { display:flex; justify-content:center; gap:32px; margin-bottom:24px; flex-wrap:wrap; }
    .agent-feat { text-align:center; }
    .agent-feat-icon { font-size:24px; margin-bottom:6px; }
    .agent-feat-text { font-size:10px; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px; }
    .btn-waitlist { padding:12px 32px; background:transparent; border:1px solid var(--yellow); color:var(--yellow); font-family:inherit; font-size:11px; font-weight:700; letter-spacing:2px; text-transform:uppercase; cursor:pointer; transition:all .2s; }
    .btn-waitlist:hover { background:rgba(255,170,0,0.08); box-shadow:0 0 20px rgba(255,170,0,0.15); }

    /* Footer */
    .footer { padding:40px 32px; border-top:1px solid var(--border); text-align:center; }
    .footer-links { display:flex; justify-content:center; gap:20px; margin-bottom:12px; }
    .footer-links a { color:var(--text-dim); text-decoration:none; font-size:10px; letter-spacing:1px; text-transform:uppercase; transition:color .2s; }
    .footer-links a:hover { color:var(--green); }
    .footer-note { font-size:9px; color:var(--text-dim); opacity:0.5; }

    /* Fade-in animation */
    .fade-in { opacity:0; transform:translateY(20px); transition:opacity .6s ease, transform .6s ease; }
    .fade-in.visible { opacity:1; transform:translateY(0); }

    /* Strategy Profiles */
    .strat-pills { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:20px; }
    .strat-pill {
      padding:6px 14px; font-family:inherit; font-size:11px; font-weight:700;
      letter-spacing:1px; background:transparent; color:var(--text-dim);
      border:1px solid var(--border); cursor:pointer; transition:all .2s;
    }
    .strat-pill:hover { color:var(--green); border-color:var(--border-bright); }
    .strat-pill.selected { color:var(--green); border-color:var(--green); background:rgba(0,255,65,0.06); box-shadow:0 0 8px rgba(0,255,65,0.15); }
    .strat-pill .pill-active { font-size:7px; color:var(--bg); background:var(--green); padding:1px 4px; margin-left:4px; vertical-align:middle; letter-spacing:0.5px; }
    .strat-detail { background:var(--card); border:1px solid var(--border); padding:24px; margin-bottom:20px; }
    .strat-detail-header { display:flex; align-items:center; gap:12px; margin-bottom:16px; flex-wrap:wrap; }
    .strat-detail-name { font-size:18px; font-weight:900; color:var(--text-bright); }
    .strat-detail-desc { font-size:11px; color:var(--text-dim); line-height:1.6; margin-bottom:16px; }
    .strat-params { width:100%; border-collapse:collapse; font-size:10px; }
    .strat-params th { text-align:left; color:var(--green); font-weight:600; padding:4px 10px 4px 0; border-bottom:1px solid var(--border); text-transform:uppercase; letter-spacing:1px; font-size:9px; }
    .strat-params td { padding:5px 10px 5px 0; border-bottom:1px solid rgba(255,255,255,0.03); color:var(--text); }
    .strat-params td:first-child { color:var(--text-dim); }
    .risk-badge { display:inline-block; padding:2px 8px; font-size:9px; font-weight:700; letter-spacing:1px; text-transform:uppercase; }
    .risk-low { background:rgba(0,255,65,0.1); color:var(--green); border:1px solid rgba(0,255,65,0.2); }
    .risk-medium { background:rgba(255,170,0,0.1); color:var(--yellow); border:1px solid rgba(255,170,0,0.2); }
    .risk-high { background:rgba(255,51,51,0.1); color:var(--red); border:1px solid rgba(255,51,51,0.2); }
    .strat-compare { width:100%; border-collapse:collapse; font-size:10px; background:var(--card); border:1px solid var(--border); }
    .strat-compare th { padding:8px 6px; text-align:center; color:var(--green); font-size:9px; font-weight:600; letter-spacing:1px; text-transform:uppercase; border-bottom:1px solid var(--border); }
    .strat-compare td { padding:6px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.03); color:var(--text-dim); }
    .strat-compare tr:hover td { background:rgba(0,255,65,0.03); }
    .strat-compare .col-name { text-align:left; color:var(--text-bright); font-weight:700; }
    .strat-compare .col-active { color:var(--green); }

    /* Brain Flow Diagram */
    .brain-flow-section { padding:0 0 40px; text-align:center; }
    .brain-flow-wrap {
      position:relative; max-width:1100px; margin:0 auto;
      border:1px solid var(--border); background:rgba(0,255,65,0.01);
      overflow:hidden;
    }
    .brain-flow-wrap canvas { display:block; width:100%; height:420px; }
    .brain-flow-title {
      font-size:10px; letter-spacing:3px; text-transform:uppercase;
      color:var(--green); opacity:0.6; padding:16px 0 4px; margin:0 auto;
    }

    /* Brain Stats Bar */
    .brain-stats {
      display:flex; justify-content:center; gap:32px; flex-wrap:wrap;
      padding:20px 32px; max-width:1100px; margin:0 auto;
      border:1px solid var(--border); border-top:none;
      background:var(--card);
    }
    .brain-stat { text-align:center; }
    .brain-stat-val { font-size:18px; font-weight:900; color:var(--green); }
    .brain-stat-label { font-size:9px; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px; margin-top:2px; }

    /* Tab Bar */
    .tab-bar {
      display:flex; justify-content:center; gap:0;
      max-width:400px; margin:0 auto 10px;
      padding:0 32px;
    }
    .tab-btn {
      flex:1; padding:14px 28px;
      font-family:inherit; font-size:11px; font-weight:700;
      letter-spacing:2px; text-transform:uppercase;
      background:transparent; color:var(--text-dim);
      border:1px solid var(--border);
      cursor:pointer; transition:all .25s;
      position:relative;
    }
    .tab-btn:first-child { border-right:none; }
    .tab-btn:hover { color:var(--green); background:rgba(0,255,65,0.03); }
    .tab-btn.tab-active {
      color:var(--green); background:rgba(0,255,65,0.06);
      border-color:var(--green);
      box-shadow:0 0 12px rgba(0,255,65,0.1), inset 0 0 20px rgba(0,255,65,0.03);
    }
    .tab-btn.tab-active::after {
      content:''; position:absolute; bottom:-1px; left:20%; right:20%;
      height:2px; background:var(--green);
      box-shadow:0 0 8px var(--green);
    }
    .tab-panel { display:none; }
    .tab-panel.tab-visible { display:block; }

    /* Responsive */
    @media (max-width:900px) {
      .grid-3 { grid-template-columns:1fr; }
      .grid-2 { grid-template-columns:1fr; }
      .hero h1 { font-size:28px; }
      section { padding:60px 16px 40px; }
      .hero { padding-top:40px; }
      .agent-features { gap:16px; }
      .brain-flow-wrap canvas { height:320px; }
      .brain-stats { gap:16px; padding:16px; }
    }
    @media (max-width:600px) {
      header { padding:10px 16px; }
      .hero-cta { flex-direction:column; align-items:center; }
      .brain-flow-wrap canvas { height:520px; }
      .brain-stats { gap:12px; }
      .brain-stat-val { font-size:14px; }
      .tab-bar { padding:0 16px; }
      .tab-btn { padding:10px 16px; font-size:10px; letter-spacing:1px; }
    }
  </style>
</head>
<body>

<!-- Header -->
<header>
  <div style="display:flex;align-items:center;gap:4px;">
    <a href="/" class="logo">r<span>Poly</span>_</a>
    <nav style="display:flex;gap:2px;margin-left:12px;">
      <a href="/" class="nav-tab">Dashboard</a>
      <a href="/hub" class="nav-tab nav-tab-active">Hub</a>
    </nav>
  </div>
  <div style="text-align:center;">
    <div class="header-clock">
      <span class="clock-time" id="utc-time">--:--:--</span>
      <span class="clock-label">UTC</span>
      <span class="clock-sep">|</span>
      <span class="clock-time" id="pl-time">--:--:--</span>
      <span class="clock-label">PL</span>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:6px;justify-self:end;">
    <span class="dot" id="nav-dot"></span>
    <span style="font-size:10px;color:var(--text-dim);" id="nav-status-text">--</span>
  </div>
</header>

<!-- Hero -->
<section class="hero">
  <div class="fade-in">
    <div class="hero-pre">// autonomous trading intelligence</div>
    <h1>OpenClaw <span class="accent">Brain</span></h1>
    <p class="hero-sub">
      Self-evolving neural trading system. 7 signal engines fuse market data, whale flow,
      and price momentum into autonomous decisions &mdash; calibrating after every trade.
      Strategies distilled from Simons, Thorp, Dalio, and Livermore.
    </p>
    <div class="hero-badges">
      <span class="badge live"><span class="dot on" style="margin-right:4px;"></span> Brain Active</span>
      <span class="badge" id="badge-snapshots">-- snapshots</span>
      <span class="badge" id="badge-trades">-- trades learned</span>
      <span class="badge" id="badge-whales">-- whale scans</span>
    </div>
  </div>
</section>

<!-- Tab Switcher -->
<div class="tab-bar">
  <button class="tab-btn tab-active" onclick="switchTab('brain')" data-tab="brain">Brain</button>
  <button class="tab-btn" onclick="switchTab('data')" data-tab="data">Data</button>
</div>

<!-- ===== BRAIN TAB ===== -->
<div class="tab-panel tab-visible" id="tab-brain">

<!-- Brain Flow Diagram -->
<section class="brain-flow-section fade-in" id="brain-flow">
  <div class="brain-flow-title">Neural Architecture</div>
  <div class="brain-flow-wrap">
    <canvas id="brain-canvas"></canvas>
  </div>
</section>

<!-- Strategy Profiles -->
<section id="strategy-profiles">
  <div class="section-label fade-in">Risk Management</div>
  <div class="section-title fade-in">Strategy Profiles</div>
  <p class="section-sub fade-in">Pre-built risk profiles generated during the Student stage. Each profile defines stop-loss, take-profit, trailing stops, and hold zones for binary 5-minute markets.</p>

  <div class="fade-in">
    <div class="strat-pills" id="strat-pills"></div>
    <div class="strat-detail" id="strat-detail">
      <div style="color:var(--text-dim);font-size:11px;">Loading strategies...</div>
    </div>
    <div style="overflow-x:auto;">
      <table class="strat-compare" id="strat-compare">
        <thead><tr><th>Profile</th><th>SL</th><th>Emergency</th><th>Catastrophic</th><th>TP Trigger</th><th>Trail</th><th>Hold Zone</th><th>Pre-Close</th><th>Max Loss</th><th>Min WR</th><th>Risk</th></tr></thead>
        <tbody id="strat-compare-body"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- Signal Engines -->
<section id="strategies">
  <div class="section-label fade-in">Signal Engines</div>
  <div class="section-title fade-in">7 Autonomous Trading Signals</div>
  <p class="section-sub fade-in">Each signal independently analyzes a dimension of market data. The Cortex fuses them, weights by historical performance, and calibrates confidence before every trade.</p>

  <div class="signal-list fade-in">
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--red);"></div>
      <div class="signal-name">Crowd Fade</div>
      <div class="signal-desc">Contrarian play when crowd confidence exceeds 62%. Fades retail overshoot in 5-min windows.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--green);"></div>
      <div class="signal-name">Momentum</div>
      <div class="signal-desc">Rides BTC price divergence &gt;0.03% from Price-to-Beat. Time-weighted conviction.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--blue);"></div>
      <div class="signal-name">Whale Follow</div>
      <div class="signal-desc">Follows top 10 holders when capital concentrates &gt;60% on one side.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--yellow);"></div>
      <div class="signal-name">Odds Shift</div>
      <div class="signal-desc">Detects rapid odds movement &gt;5pts across snapshots. Rides new information early.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--green);"></div>
      <div class="signal-name">Odds Bias</div>
      <div class="signal-desc">Fallback signal using raw market odds deviation from 50/50 when BTC data unavailable.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--red);"></div>
      <div class="signal-name">Mean Reversion</div>
      <div class="signal-desc">Fades overreaction after extreme moves &gt;0.1% BTC divergence + odds &gt;75%.</div>
      <span class="signal-status">Active</span>
    </div>
    <div class="signal-row">
      <div class="signal-accent" style="background:var(--blue);"></div>
      <div class="signal-name">Volume Spike</div>
      <div class="signal-desc">Detects unusual volume bursts with buying pressure &gt;65% in the last 2 minutes.</div>
      <span class="signal-status">Active</span>
    </div>
  </div>
</section>

<!-- Self-Learning System -->
<section id="agents">
  <div class="fade-in">
    <div class="agent-section">
      <div class="section-label" style="text-align:center;">Evolution</div>
      <h3>Self-Learning System</h3>
      <p>
        Every trade rewrites the brain. Strategy weights shift based on P/L, confidence calibration
        corrects overconfidence, and hourly performance gates adapt to market rhythm.
        Five evolution stages from Student to Grandmaster &mdash; each unlocking larger positions
        and tighter Kelly fractions.
      </p>
      <div class="agent-features">
        <div class="agent-feat">
          <div class="agent-feat-icon" style="color:var(--text-dim);">I</div>
          <div class="agent-feat-text">Student</div>
          <div style="font-size:9px;color:var(--text-dim);margin-top:2px;">0-100 trades &middot; $1 max</div>
        </div>
        <div class="agent-feat">
          <div class="agent-feat-icon" style="color:var(--yellow);">II</div>
          <div class="agent-feat-text">Apprentice</div>
          <div style="font-size:9px;color:var(--text-dim);margin-top:2px;">100-500 &middot; $2 max &middot; 52% WR</div>
        </div>
        <div class="agent-feat">
          <div class="agent-feat-icon" style="color:var(--blue);">III</div>
          <div class="agent-feat-text">Journeyman</div>
          <div style="font-size:9px;color:var(--text-dim);margin-top:2px;">500-2K &middot; $5 max &middot; 54% WR</div>
        </div>
        <div class="agent-feat">
          <div class="agent-feat-icon" style="color:var(--green);">IV</div>
          <div class="agent-feat-text">Master</div>
          <div style="font-size:9px;color:var(--text-dim);margin-top:2px;">2K-10K &middot; $20 max &middot; 55% WR</div>
        </div>
        <div class="agent-feat">
          <div class="agent-feat-icon" style="color:var(--green);text-shadow:0 0 12px rgba(0,255,65,0.6);">V</div>
          <div class="agent-feat-text">Grandmaster</div>
          <div style="font-size:9px;color:var(--text-dim);margin-top:2px;">10K+ &middot; $100 max &middot; Half Kelly</div>
        </div>
      </div>
    </div>
  </div>
</section>

</div><!-- /tab-brain -->

<!-- ===== DATA TAB ===== -->
<div class="tab-panel" id="tab-data">

<!-- Live Data -->
<section id="live">
  <div class="section-label fade-in">Live Data</div>
  <div class="section-title fade-in">Real-Time Intelligence</div>
  <p class="section-sub fade-in">Data collected every 30 seconds from Polymarket CLOB and Data APIs.</p>

  <div class="grid-3 fade-in">
    <!-- Odds Pulse -->
    <div class="card live-card">
      <div class="live-label">Odds Pulse (UP token)</div>
      <div class="live-val" id="live-odds">--</div>
      <div style="font-size:10px;color:var(--text-dim);" id="live-odds-market">loading...</div>
      <canvas class="live-chart" id="mini-odds-chart"></canvas>
      <span class="card-tag tag-live">Live</span>
    </div>

    <!-- Whale Radar -->
    <div class="card live-card">
      <div class="live-label">Whale Radar</div>
      <div class="live-val" id="live-whale-count">--</div>
      <div style="font-size:10px;color:var(--text-dim);">top holders this market</div>
      <div id="whale-list" style="margin-top:10px;">
        <div style="color:var(--text-dim);font-size:10px;">loading...</div>
      </div>
      <span class="card-tag tag-live">Live</span>
    </div>

    <!-- Trade Flow -->
    <div class="card live-card">
      <div class="live-label">Trade Flow</div>
      <div class="live-val" id="live-flow">--</div>
      <div style="font-size:10px;color:var(--text-dim);" id="live-flow-sub">loading...</div>
      <div class="ratio-bar">
        <div class="ratio-buy" id="ratio-buy" style="width:50%;"></div>
        <div class="ratio-sell" id="ratio-sell" style="width:50%;"></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:9px;">
        <span style="color:var(--green);" id="ratio-buy-pct">--% buy</span>
        <span style="color:var(--red);" id="ratio-sell-pct">--% sell</span>
      </div>
      <div id="trade-feed" style="margin-top:8px;"></div>
      <span class="card-tag tag-live">Live</span>
    </div>
  </div>
</section>

<!-- API Documentation -->
<section id="api">
  <div class="section-label fade-in">API</div>
  <div class="section-title fade-in">Public Endpoints</div>
  <p class="section-sub fade-in">Access rPoly intelligence data via REST API. All endpoints return JSON.</p>

  <div class="fade-in" id="api-list">

    <div class="api-endpoint">
      <div class="api-header" onclick="toggleApi(this)">
        <span class="api-method">GET</span>
        <span class="api-path">/api/learn/status</span>
        <span class="api-desc">Collector status and stats</span>
        <span class="api-chevron">&#9654;</span>
      </div>
      <div class="api-body">
        <div class="code-block"><span class="kw">curl</span> <span class="str">https://rpoly.vercel.app/api/learn/status</span></div>
        <div class="code-block">{
  <span class="str">"running"</span>: <span class="kw">true</span>,
  <span class="str">"stats"</span>: {
    <span class="str">"odds"</span>: <span class="num">142</span>,
    <span class="str">"globalTrades"</span>: <span class="num">3847</span>,
    <span class="str">"whales"</span>: <span class="num">28</span>,
    <span class="str">"lastMarket"</span>: <span class="str">"btc-updown-5m-1771287300"</span>
  },
  <span class="str">"timestamp"</span>: <span class="num">1771287205054</span>
}</div>
      </div>
    </div>

    <div class="api-endpoint">
      <div class="api-header" onclick="toggleApi(this)">
        <span class="api-method">GET</span>
        <span class="api-path">/api/learn/odds-history</span>
        <span class="api-desc">Historical odds snapshots</span>
        <span class="api-chevron">&#9654;</span>
      </div>
      <div class="api-body">
        <div class="code-block"><span class="kw">curl</span> <span class="str">"https://rpoly.vercel.app/api/learn/odds-history?minutes=60"</span></div>
        <div class="code-block">{
  <span class="str">"count"</span>: <span class="num">120</span>,
  <span class="str">"data"</span>: [
    {
      <span class="str">"t"</span>: <span class="num">1771287075014</span>,
      <span class="str">"market"</span>: <span class="str">"btc-updown-5m-1771287300"</span>,
      <span class="str">"upPrice"</span>: <span class="num">0.505</span>,
      <span class="str">"downPrice"</span>: <span class="num">0.495</span>,
      <span class="str">"midpoint"</span>: <span class="num">0.505</span>,
      <span class="str">"volume"</span>: <span class="num">78.71</span>
    }
  ]
}</div>
        <div style="font-size:10px;color:var(--text-dim);margin-top:8px;">
          Params: <code>minutes</code> (default 60), <code>market</code> (slug filter)
        </div>
      </div>
    </div>

    <div class="api-endpoint">
      <div class="api-header" onclick="toggleApi(this)">
        <span class="api-method">GET</span>
        <span class="api-path">/api/learn/whales</span>
        <span class="api-desc">Top holders for current market</span>
        <span class="api-chevron">&#9654;</span>
      </div>
      <div class="api-body">
        <div class="code-block"><span class="kw">curl</span> <span class="str">https://rpoly.vercel.app/api/learn/whales</span></div>
        <div class="code-block">{
  <span class="str">"latest"</span>: {
    <span class="str">"market"</span>: <span class="str">"btc-updown-5m-..."</span>,
    <span class="str">"holders"</span>: [
      { <span class="str">"name"</span>: <span class="str">"Long-Security"</span>, <span class="str">"amount"</span>: <span class="num">100</span>, <span class="str">"outcome"</span>: <span class="str">"UP"</span> },
      { <span class="str">"name"</span>: <span class="str">"Dental-Constraint"</span>, <span class="str">"amount"</span>: <span class="num">92.3</span>, <span class="str">"outcome"</span>: <span class="str">"UP"</span> }
    ]
  },
  <span class="str">"totalScans"</span>: <span class="num">14</span>
}</div>
      </div>
    </div>

    <div class="api-endpoint">
      <div class="api-header" onclick="toggleApi(this)">
        <span class="api-method">GET</span>
        <span class="api-path">/api/learn/global-trades</span>
        <span class="api-desc">Recent trades and buy/sell stats</span>
        <span class="api-chevron">&#9654;</span>
      </div>
      <div class="api-body">
        <div class="code-block"><span class="kw">curl</span> <span class="str">https://rpoly.vercel.app/api/learn/global-trades</span></div>
        <div class="code-block">{
  <span class="str">"trades"</span>: [ ... ],
  <span class="str">"stats"</span>: {
    <span class="str">"total"</span>: <span class="num">847</span>,
    <span class="str">"buys"</span>: <span class="num">612</span>,
    <span class="str">"sells"</span>: <span class="num">235</span>,
    <span class="str">"avgSize"</span>: <span class="str">"15.17"</span>
  }
}</div>
      </div>
    </div>

    <div class="api-endpoint">
      <div class="api-header" onclick="toggleApi(this)">
        <span class="api-method">GET</span>
        <span class="api-path">/api/learn/patterns</span>
        <span class="api-desc">Discovered market patterns</span>
        <span class="api-chevron">&#9654;</span>
      </div>
      <div class="api-body">
        <div class="code-block"><span class="kw">curl</span> <span class="str">https://rpoly.vercel.app/api/learn/patterns</span></div>
        <div class="code-block">{
  <span class="str">"totalSnapshots"</span>: <span class="num">4200</span>,
  <span class="str">"totalMarkets"</span>: <span class="num">350</span>,
  <span class="str">"uniqueDays"</span>: <span class="num">3</span>,
  <span class="str">"oddsBuckets"</span>: { ... },
  <span class="str">"lastUpdated"</span>: <span class="num">1771287205054</span>
}</div>
        <div style="font-size:10px;color:var(--text-dim);margin-top:8px;">
          Pattern analysis improves with more collected data. Rebuilds every 5 minutes.
        </div>
      </div>
    </div>

  </div>
</section>

</div><!-- /tab-data -->

<!-- Footer -->
<footer class="footer">
  <div class="footer-note" id="footer-status">
    OpenClaw Brain | Polymarket CLOB + Data API | Collector: --
  </div>
</footer>

<script>
// ===== CLOCK =====
function updateClock() {
  const now = new Date();
  const utcEl = document.getElementById('utc-time');
  const plEl = document.getElementById('pl-time');
  if (utcEl) utcEl.textContent = now.toLocaleTimeString('en-GB',{timeZone:'UTC',hour12:false});
  if (plEl) plEl.textContent = now.toLocaleTimeString('en-GB',{timeZone:'Europe/Warsaw',hour12:false});
}
setInterval(updateClock, 1000);
updateClock();

// ===== TAB SWITCHING =====
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('tab-active', b.dataset.tab === tab));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('tab-visible', p.id === 'tab-' + tab));
  if (tab === 'brain') {
    window.dispatchEvent(new Event('resize'));
  }
  if (tab === 'data') {
    fetchOdds();
    fetchWhales();
    fetchTradeFlow();
  }
  document.querySelectorAll('.tab-panel.tab-visible .fade-in:not(.visible)').forEach(el => {
    el.classList.add('visible');
  });
}

// ===== NAV STATUS =====
async function fetchStatus() {
  try {
    const r = await fetch('/api/learn/status');
    const d = await r.json();
    const dot = document.getElementById('nav-dot');
    dot.className = 'dot ' + (d.running ? 'on' : 'off');
    document.getElementById('nav-status-text').textContent =
      d.running ? d.stats.odds + ' snapshots' : 'Offline';
    document.getElementById('badge-snapshots').textContent = (d.stats.odds || 0) + ' snapshots';
    document.getElementById('badge-trades').textContent = (d.stats.globalTrades || 0) + ' trades learned';
    document.getElementById('badge-whales').textContent = (d.stats.whales || 0) + ' whale scans';
    document.getElementById('footer-status').textContent =
      'OpenClaw Brain | Polymarket CLOB + Data API | Collector: ' +
      (d.running ? 'RUNNING' : 'OFFLINE') + ' | ' + (d.stats.odds||0) + ' odds / ' + (d.stats.globalTrades||0) + ' trades today';
  } catch(e) {}
}

// ===== LIVE ODDS =====
async function fetchOdds() {
  try {
    const r = await fetch('/api/learn/odds-history?minutes=30');
    const d = await r.json();
    if (d.data.length > 0) {
      const last = d.data[d.data.length - 1];
      document.getElementById('live-odds').textContent = (last.upPrice * 100).toFixed(1) + '%';
      document.getElementById('live-odds-market').textContent = last.question || last.market;
      drawMiniChart(d.data);
    }
  } catch(e) {}
}

function drawMiniChart(data) {
  const canvas = document.getElementById('mini-odds-chart');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, w, h);

  if (data.length < 2) return;

  const pad = 4;
  const cw = w - pad * 2;
  const ch = h - pad * 2;
  let minY = 0.4, maxY = 0.6;
  data.forEach(d => {
    if (d.upPrice < minY) minY = d.upPrice - 0.02;
    if (d.upPrice > maxY) maxY = d.upPrice + 0.02;
  });

  ctx.strokeStyle = '#00ff41';
  ctx.lineWidth = 1.5;
  ctx.shadowColor = 'rgba(0,255,65,0.4)';
  ctx.shadowBlur = 4;
  ctx.beginPath();
  data.forEach((d, i) => {
    const x = pad + (i / (data.length - 1)) * cw;
    const y = pad + ((maxY - d.upPrice) / (maxY - minY)) * ch;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.stroke();

  ctx.strokeStyle = '#ff3333';
  ctx.shadowColor = 'rgba(255,50,50,0.3)';
  ctx.beginPath();
  data.forEach((d, i) => {
    const x = pad + (i / (data.length - 1)) * cw;
    const y = pad + ((maxY - d.downPrice) / (maxY - minY)) * ch;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.stroke();
  ctx.shadowBlur = 0;
}

// ===== LIVE WHALES =====
async function fetchWhales() {
  try {
    const r = await fetch('/api/learn/whales');
    const d = await r.json();
    const el = document.getElementById('whale-list');
    if (!d.latest || !d.latest.holders?.length) {
      document.getElementById('live-whale-count').textContent = '0';
      el.innerHTML = '<div style="color:var(--text-dim);font-size:10px;">No whale data yet</div>';
      return;
    }
    const holders = d.latest.holders.slice(0, 5);
    document.getElementById('live-whale-count').textContent = holders.length;
    let html = '';
    holders.forEach((h, i) => {
      const isUp = h.outcome === 'UP';
      html += '<div class="live-row">';
      html += '<span style="color:var(--text-dim);">' + (i+1) + '. ' + (h.name || h.addr) + '</span>';
      html += '<span style="color:' + (isUp ? 'var(--green)' : 'var(--red)') + ';font-weight:700;">' + h.amount.toFixed(0) + ' ' + h.outcome + '</span>';
      html += '</div>';
    });
    el.innerHTML = html;
  } catch(e) {}
}

// ===== LIVE TRADE FLOW =====
async function fetchTradeFlow() {
  try {
    const r = await fetch('/api/learn/global-trades');
    const d = await r.json();
    const total = d.stats.total || 0;
    const buys = d.stats.buys || 0;
    const sells = d.stats.sells || 0;
    const buyPct = total > 0 ? Math.round((buys / total) * 100) : 50;
    const sellPct = 100 - buyPct;

    document.getElementById('live-flow').textContent = total + ' trades';
    document.getElementById('live-flow-sub').textContent = 'avg ' + d.stats.avgSize + ' shares';
    document.getElementById('ratio-buy').style.width = buyPct + '%';
    document.getElementById('ratio-sell').style.width = sellPct + '%';
    document.getElementById('ratio-buy-pct').textContent = buyPct + '% buy';
    document.getElementById('ratio-sell-pct').textContent = sellPct + '% sell';

    const feed = document.getElementById('trade-feed');
    if (d.trades?.length > 0) {
      const last5 = d.trades.slice(-5).reverse();
      let html = '';
      last5.forEach(t => {
        const isBuy = t.side === 'BUY';
        html += '<div class="live-row">';
        html += '<span style="color:' + (isBuy ? 'var(--green)' : 'var(--red)') + ';font-weight:700;font-size:9px;">' + t.side + '</span>';
        html += '<span style="font-size:9px;">' + (parseFloat(t.size)||0).toFixed(0) + 'sh</span>';
        html += '<span style="font-size:9px;color:var(--text-dim);">@$' + (parseFloat(t.price)||0).toFixed(2) + '</span>';
        html += '</div>';
      });
      feed.innerHTML = html;
    }
  } catch(e) {}
}

// ===== API TOGGLE =====
function toggleApi(header) {
  const body = header.nextElementSibling;
  const chevron = header.querySelector('.api-chevron');
  body.classList.toggle('open');
  chevron.classList.toggle('open');
}

// ===== FADE IN ON SCROLL =====
function initFadeIn() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
}

// ===== STRATEGY PROFILES =====
let strategyData = null;
async function fetchStrategies() {
  try {
    const r = await fetch('/api/strategies');
    strategyData = await r.json();
    if (!strategyData || !strategyData.profiles) return;
    renderStrategyPills(strategyData);
    renderStrategyDetail(strategyData.active);
    renderStrategyCompare(strategyData);
  } catch(e) {}
}

function renderStrategyPills(data) {
  const container = document.getElementById('strat-pills');
  const keys = Object.keys(data.profiles);
  container.innerHTML = keys.map(k => {
    const p = data.profiles[k];
    const isActive = k === data.active;
    return '<button class="strat-pill' + (isActive ? ' selected' : '') + '" data-key="' + k + '" onclick="selectStrategy(\'' + k + '\')">'
      + k + ': ' + p.name
      + (isActive ? '<span class="pill-active">ACTIVE</span>' : '')
      + '</button>';
  }).join('');
}

function selectStrategy(key) {
  document.querySelectorAll('.strat-pill').forEach(el => {
    el.classList.toggle('selected', el.dataset.key === key);
  });
  renderStrategyDetail(key);
}

function pct(v) { return (Math.abs(v) * 100).toFixed(0) + '%'; }

function renderStrategyDetail(key) {
  if (!strategyData) return;
  const p = strategyData.profiles[key];
  if (!p) return;
  const isActive = key === strategyData.active;
  const riskClass = p.riskLevel === 'low' ? 'risk-low' : p.riskLevel === 'high' ? 'risk-high' : 'risk-medium';
  const holdType = p.tpTrail > 0 ? 'Trailing (' + pct(p.tpTrail) + ' from peak)' : 'Fixed';
  const gainRange = '$' + p.expectedGain[0].toFixed(2) + ' - $' + p.expectedGain[1].toFixed(2);

  document.getElementById('strat-detail').innerHTML =
    '<div class="strat-detail-header">'
    + '<span class="strat-detail-name">' + key + ': ' + p.name + '</span>'
    + '<span class="risk-badge ' + riskClass + '">' + p.riskLevel + '</span>'
    + (isActive ? '<span class="card-tag tag-live">Active</span>' : '')
    + '</div>'
    + '<div class="strat-detail-desc">' + p.description + '</div>'
    + '<table class="strat-params">'
    + '<tr><th colspan="2">Exit Parameters</th><th colspan="2">Timing</th></tr>'
    + '<tr><td>Stop Loss</td><td style="color:var(--red);font-weight:700;">' + pct(p.stopLoss) + '</td>'
    + '<td>Min Hold (SL)</td><td>' + p.minHoldSL + 's</td></tr>'
    + '<tr><td>Emergency</td><td style="color:var(--red);">' + pct(p.emergencyLoss) + ' (' + (p.minHoldEmergency || 5) + 's)</td>'
    + '<td>Catastrophic</td><td style="color:var(--red);font-weight:700;">' + (p.catastrophicLoss ? pct(p.catastrophicLoss) + ' (instant)' : 'n/a') + '</td></tr>'
    + '<tr><td></td><td></td>'
    + '<td>Min Hold (TP)</td><td>' + p.minHoldTP + 's</td></tr>'
    + '<tr><td>TP Trigger</td><td style="color:var(--green);font-weight:700;">+' + pct(p.tpTrigger) + '</td>'
    + '<td>Pre-Close</td><td>' + p.preCloseSec + 's</td></tr>'
    + '<tr><td>TP Type</td><td>' + holdType + '</td>'
    + '<td>Hold Zone</td><td>+' + pct(p.holdZoneMin) + ' to +' + pct(p.holdZoneMax) + '</td></tr>'
    + '<tr><th colspan="2">Risk Profile</th><th colspan="2">Expected</th></tr>'
    + '<tr><td>Max Loss / Trade</td><td style="color:var(--red);">$' + p.maxLossPerTrade.toFixed(2) + '</td>'
    + '<td>Expected Gain</td><td style="color:var(--green);">' + gainRange + '</td></tr>'
    + '<tr><td>Risk Level</td><td><span class="risk-badge ' + riskClass + '">' + p.riskLevel + '</span></td>'
    + '<td>Required WR</td><td>' + (p.requiredWR * 100).toFixed(0) + '%</td></tr>'
    + '</table>';
}

function renderStrategyCompare(data) {
  const tbody = document.getElementById('strat-compare-body');
  const keys = Object.keys(data.profiles);
  tbody.innerHTML = keys.map(k => {
    const p = data.profiles[k];
    const isActive = k === data.active;
    const cls = isActive ? ' class="col-active"' : '';
    const riskClass = p.riskLevel === 'low' ? 'risk-low' : p.riskLevel === 'high' ? 'risk-high' : 'risk-medium';
    const catLoss = p.catastrophicLoss ? pct(p.catastrophicLoss) : '-';
    return '<tr>'
      + '<td class="col-name"' + cls + '>' + k + ': ' + p.name + (isActive ? ' *' : '') + '</td>'
      + '<td' + cls + '>' + pct(p.stopLoss) + '</td>'
      + '<td' + cls + '>' + pct(p.emergencyLoss) + '</td>'
      + '<td' + cls + '>' + catLoss + '</td>'
      + '<td' + cls + '>+' + pct(p.tpTrigger) + '</td>'
      + '<td' + cls + '>' + (p.tpTrail > 0 ? pct(p.tpTrail) : 'fixed') + '</td>'
      + '<td' + cls + '>+' + pct(p.holdZoneMin) + '-' + pct(p.holdZoneMax) + '</td>'
      + '<td' + cls + '>' + p.preCloseSec + 's</td>'
      + '<td' + cls + ' style="color:var(--red);">$' + p.maxLossPerTrade.toFixed(2) + '</td>'
      + '<td' + cls + '>' + (p.requiredWR * 100).toFixed(0) + '%</td>'
      + '<td><span class="risk-badge ' + riskClass + '">' + p.riskLevel + '</span></td>'
      + '</tr>';
  }).join('');
}

// ===== BRAIN FLOW CANVAS =====
(function() {
  const canvas = document.getElementById('brain-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let W, H, dpr, isMobile;
  const GREEN = '#00ff41';
  const DIM = '#1a2a1a';
  const BG = '#0a0a0a';

  const nodeData = {
    inputs: [
      { id:'btc', label:'BTC Price' },
      { id:'odds', label:'Market Odds' },
      { id:'whales', label:'Whale Flow' },
      { id:'trades', label:'Trade Flow' },
      { id:'ob', label:'Orderbook' },
    ],
    core: [
      { id:'signals', label:'7 Signal Engines' },
      { id:'fusion', label:'Signal Fusion' },
      { id:'calibration', label:'Confidence Cal.' },
      { id:'kelly', label:'Kelly Sizing' },
    ],
    outputs: [
      { id:'action', label:'BUY / SELL' },
      { id:'memory', label:'Memory Update' },
    ],
  };

  let nodes = [];
  let edges = [];
  let particles = [];
  let hoveredNode = null;
  let pulsePhase = 0;

  function layout() {
    dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    W = rect.width;
    H = rect.height;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    isMobile = W < 600;

    nodes = [];
    edges = [];

    if (isMobile) {
      layoutVertical();
    } else {
      layoutHorizontal();
    }

    buildEdges();
    particles = [];
    for (const e of edges) {
      const count = e.feedback ? 3 : 2;
      for (let i = 0; i < count; i++) {
        particles.push({ edge: e, t: Math.random(), speed: 0.002 + Math.random() * 0.003 });
      }
    }
  }

  function layoutHorizontal() {
    const nw = 120, nh = 28, gap = 10;
    const colX = [60, W * 0.35, W * 0.55, W * 0.75, W - 80];

    const inputStartY = H / 2 - (nodeData.inputs.length * (nh + gap)) / 2 + nh / 2;
    nodeData.inputs.forEach((d, i) => {
      nodes.push({ ...d, x: colX[0], y: inputStartY + i * (nh + gap), w: nw, h: nh, group: 'input' });
    });

    const coreStartY = H / 2 - (nodeData.core.length * (nh + gap)) / 2 + nh / 2;
    nodeData.core.forEach((d, i) => {
      if (i === 0) {
        nodes.push({ ...d, x: colX[1], y: H / 2, w: nw + 20, h: nh + 4, group: 'core' });
      } else if (i === 1) {
        nodes.push({ ...d, x: colX[2], y: H / 2, w: nw, h: nh, group: 'core' });
      } else {
        nodes.push({ ...d, x: colX[3], y: coreStartY + (i - 1) * (nh + gap), w: nw, h: nh, group: 'core' });
      }
    });

    const outStartY = H / 2 - (nodeData.outputs.length * (nh + gap)) / 2 + nh / 2;
    nodeData.outputs.forEach((d, i) => {
      nodes.push({ ...d, x: colX[4], y: outStartY + i * (nh + gap), w: nw, h: nh, group: 'output' });
    });
  }

  function layoutVertical() {
    const nw = 110, nh = 24, gap = 6;
    const cx = W / 2;
    let y = 30;

    const inputsPerRow = Math.min(3, Math.floor((W - 20) / (nw + 8)));
    const inputRows = Math.ceil(nodeData.inputs.length / inputsPerRow);
    for (let i = 0; i < nodeData.inputs.length; i++) {
      const row = Math.floor(i / inputsPerRow);
      const col = i % inputsPerRow;
      const rowCount = Math.min(inputsPerRow, nodeData.inputs.length - row * inputsPerRow);
      const startX = cx - (rowCount * (nw + 8)) / 2 + (nw + 8) / 2;
      nodes.push({ ...nodeData.inputs[i], x: startX + col * (nw + 8), y: y + row * (nh + gap), w: nw, h: nh, group: 'input' });
    }
    y += inputRows * (nh + gap) + 20;

    nodeData.core.forEach((d, i) => {
      const w = i === 0 ? nw + 20 : nw;
      nodes.push({ ...d, x: cx, y: y, w: w, h: nh, group: 'core' });
      y += nh + gap + 6;
    });
    y += 10;

    nodeData.outputs.forEach((d, i) => {
      nodes.push({ ...d, x: cx, y: y, w: nw, h: nh, group: 'output' });
      y += nh + gap + 6;
    });
  }

  function getNode(id) { return nodes.find(n => n.id === id); }

  function buildEdges() {
    edges = [];
    const signalsNode = getNode('signals');
    const fusionNode = getNode('fusion');
    const calNode = getNode('calibration');
    const kellyNode = getNode('kelly');
    const actionNode = getNode('action');
    const memNode = getNode('memory');

    for (const inp of nodeData.inputs) {
      const n = getNode(inp.id);
      if (n && signalsNode) edges.push({ from: n, to: signalsNode });
    }
    if (signalsNode && fusionNode) edges.push({ from: signalsNode, to: fusionNode });
    if (fusionNode && calNode) edges.push({ from: fusionNode, to: calNode });
    if (calNode && kellyNode) edges.push({ from: calNode, to: kellyNode });
    if (kellyNode && actionNode) edges.push({ from: kellyNode, to: actionNode });
    if (actionNode && memNode) edges.push({ from: actionNode, to: memNode });
    if (memNode && calNode) edges.push({ from: memNode, to: calNode, feedback: true });
  }

  function edgePoint(edge, t) {
    const f = edge.from, to = edge.to;
    const x1 = f.x, y1 = f.y, x2 = to.x, y2 = to.y;

    if (edge.feedback) {
      const offsetY = isMobile ? 30 : Math.max(60, H * 0.35);
      const offsetX = isMobile ? W * 0.4 : 0;
      const mx = (x1 + x2) / 2 + offsetX;
      const my = Math.max(y1, y2) + offsetY;
      const u = 1 - t;
      return {
        x: u * u * x1 + 2 * u * t * mx + t * t * x2,
        y: u * u * y1 + 2 * u * t * my + t * t * y2,
      };
    }

    if (!isMobile) {
      const cx1 = x1 + (x2 - x1) * 0.4;
      const cx2 = x1 + (x2 - x1) * 0.6;
      const u = 1 - t;
      return {
        x: u*u*u*x1 + 3*u*u*t*cx1 + 3*u*t*t*cx2 + t*t*t*x2,
        y: u*u*u*y1 + 3*u*u*t*y1 + 3*u*t*t*y2 + t*t*t*y2,
      };
    }

    return { x: x1 + (x2 - x1) * t, y: y1 + (y2 - y1) * t };
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);
    pulsePhase += 0.015;

    const coreNodes = nodes.filter(n => n.group === 'core');
    if (coreNodes.length >= 2) {
      const minX = Math.min(...coreNodes.map(n => n.x - n.w / 2)) - 20;
      const maxX = Math.max(...coreNodes.map(n => n.x + n.w / 2)) + 20;
      const minY = Math.min(...coreNodes.map(n => n.y - n.h / 2)) - 16;
      const maxY = Math.max(...coreNodes.map(n => n.y + n.h / 2)) + 16;
      const pulse = 0.03 + Math.sin(pulsePhase) * 0.02;
      ctx.fillStyle = `rgba(0,255,65,${pulse})`;
      ctx.strokeStyle = `rgba(0,255,65,0.12)`;
      ctx.lineWidth = 1;
      roundRect(ctx, minX, minY, maxX - minX, maxY - minY, 8);
      ctx.fill();
      ctx.stroke();

      ctx.fillStyle = 'rgba(0,255,65,0.35)';
      ctx.font = '9px JetBrains Mono';
      ctx.textAlign = 'center';
      ctx.fillText('NEURAL CORE', (minX + maxX) / 2, minY + 10);
    }

    for (const e of edges) {
      ctx.strokeStyle = e.feedback ? 'rgba(255,170,0,0.2)' : 'rgba(0,255,65,0.12)';
      ctx.lineWidth = e.feedback ? 1.5 : 1;
      ctx.beginPath();
      const steps = 40;
      for (let i = 0; i <= steps; i++) {
        const p = edgePoint(e, i / steps);
        i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
      }
      ctx.stroke();
    }

    for (const p of particles) {
      p.t += p.speed;
      if (p.t > 1) p.t -= 1;
      const pos = edgePoint(p.edge, p.t);
      const color = p.edge.feedback ? '#ffaa00' : GREEN;
      const glow = p.edge.feedback ? 'rgba(255,170,0,0.5)' : 'rgba(0,255,65,0.5)';
      ctx.beginPath();
      ctx.arc(pos.x, pos.y, 2.5, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.shadowColor = glow;
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    for (const n of nodes) {
      const isHovered = hoveredNode === n;
      const glowAmt = isHovered ? 0.3 : (n.group === 'core' ? 0.08 + Math.sin(pulsePhase + nodes.indexOf(n)) * 0.04 : 0.04);
      ctx.fillStyle = `rgba(0,255,65,${glowAmt})`;
      ctx.strokeStyle = isHovered ? GREEN : `rgba(0,255,65,${n.group === 'core' ? 0.5 : 0.3})`;
      ctx.lineWidth = isHovered ? 2 : 1;
      if (isHovered) {
        ctx.shadowColor = 'rgba(0,255,65,0.4)';
        ctx.shadowBlur = 16;
      }
      roundRect(ctx, n.x - n.w / 2, n.y - n.h / 2, n.w, n.h, 4);
      ctx.fill();
      ctx.stroke();
      ctx.shadowBlur = 0;

      ctx.fillStyle = isHovered ? '#e0ffe0' : '#c9d1d9';
      ctx.font = `${isHovered ? '700' : '500'} ${isMobile ? 9 : 11}px JetBrains Mono`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(n.label, n.x, n.y);
    }

    const groupLabels = [
      { group: 'input', label: 'DATA INPUTS', color: 'rgba(0,255,65,0.25)' },
      { group: 'output', label: 'ACTIONS', color: 'rgba(0,255,65,0.25)' },
    ];
    for (const gl of groupLabels) {
      const gn = nodes.filter(n => n.group === gl.group);
      if (gn.length === 0) continue;
      const cx = gn.reduce((s, n) => s + n.x, 0) / gn.length;
      const topY = Math.min(...gn.map(n => n.y - n.h / 2));
      ctx.fillStyle = gl.color;
      ctx.font = '8px JetBrains Mono';
      ctx.textAlign = 'center';
      ctx.fillText(gl.label, cx, topY - 10);
    }

    const fbEdge = edges.find(e => e.feedback);
    if (fbEdge) {
      const mid = edgePoint(fbEdge, 0.5);
      ctx.fillStyle = 'rgba(255,170,0,0.45)';
      ctx.font = '8px JetBrains Mono';
      ctx.textAlign = 'center';
      const offsetX = isMobile ? 0 : 40;
      const offsetY = isMobile ? 8 : 12;
      ctx.fillText('FEEDBACK LOOP', mid.x + offsetX, mid.y + offsetY);
    }

    requestAnimationFrame(draw);
  }

  function roundRect(ctx, x, y, w, h, r) {
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.lineTo(x + w - r, y);
    ctx.quadraticCurveTo(x + w, y, x + w, y + r);
    ctx.lineTo(x + w, y + h - r);
    ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
    ctx.lineTo(x + r, y + h);
    ctx.quadraticCurveTo(x, y + h, x, y + h - r);
    ctx.lineTo(x, y + r);
    ctx.quadraticCurveTo(x, y, x + r, y);
    ctx.closePath();
  }

  canvas.addEventListener('mousemove', function(e) {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    hoveredNode = null;
    for (const n of nodes) {
      if (mx >= n.x - n.w / 2 && mx <= n.x + n.w / 2 && my >= n.y - n.h / 2 && my <= n.y + n.h / 2) {
        hoveredNode = n;
        break;
      }
    }
    canvas.style.cursor = hoveredNode ? 'pointer' : 'default';
  });

  canvas.addEventListener('mouseleave', function() { hoveredNode = null; });

  window.addEventListener('resize', layout);
  layout();
  draw();
})();

// ===== INIT =====
function init() {
  initFadeIn();
  fetchStatus();
  fetchOdds();
  fetchWhales();
  fetchTradeFlow();
  fetchStrategies();

  setInterval(fetchStatus, 15000);
  setInterval(fetchOdds, 30000);
  setInterval(fetchWhales, 60000);
  setInterval(fetchTradeFlow, 30000);
}

init();
</script>
</body>
</html>
